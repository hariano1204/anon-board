<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Thread</title>
  <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
</head>
<body>
  <h1>Thread view</h1>

  <div id="thread"></div>

  <h2>Quick reply:</h2>
  <form id="newReply">
    <textarea name="text" placeholder="reply text..." required></textarea><br>
    <input type="text" name="delete_password" placeholder="password to delete" required><br>
    <input type="submit" value="Submit">
  </form>

  <script>
    const parts = window.location.pathname.split('/');
    const board = parts[2];
    const thread_id = parts[3];

    // Cargar thread con replies
    $.getJSON("/api/replies/" + board + "?thread_id=" + thread_id, function(data) {
      $("#thread").append(`<h3>${data.text}</h3>`);
      data.replies.forEach(function(reply) {
        $("#thread").append(`<p>${reply.text} (id: ${reply._id})</p>`);
      });
    });

    // Crear nuevo reply
    $("#newReply").submit(function(e) {
      e.preventDefault();
      $.post("/api/replies/" + board, $(this).serialize() + "&thread_id=" + thread_id, function() {
        window.location.reload();
      });
    });
  </script>
</body>
</html>
